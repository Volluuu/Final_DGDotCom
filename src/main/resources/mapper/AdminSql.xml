<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="data.mapper.AdminMapper">

    <!--=================================유저시작=============================================-->

    <!--    총 유저수-->
    <select id="TotalUser" resultType="int">
        select count(*)
        from user
    </select>

    <!--회원정보-->
    <select id="AdminGetAllUser" resultType="UserDto">
        select *
        from user
    </select>

    <!--회원삭제-->
    <delete id="DeleteUser" parameterType="int">
        delete
        from user
        where u_num = #{u_num}
    </delete>

    <!--회원 페이징처리-->
    <select id="AdminUserPaging" parameterType="Map" resultType="UserDto">
        select *
        from user
        order by u_num desc limit #{startnum}, #{perpage}
    </select>
    <!--=================================상품시작=============================================-->
    <!--총 상품수-->
    <select id="TotalProduct" resultType="int">
        select count(*)
        from product
    </select>

    <!-- 상품-->
    <select id="GetAllProduct" resultType="int">
        select *
        from product
    </select>

    <select id="ProductPaging" parameterType="Map" resultType="JoinDto">
        SELECT product.p_num,
               product.category,
               product.photo,
               product.brand,
               product.p_name,
               product.price,
               inven.i_num,
               inven.sellamount,
               inven.p_size,
               inven.amount
        from product
                 left join inven on product.p_num = inven.p_num
        order by product.p_num desc limit #{startnum},#{perpage}
    </select>

    <!--상품 정보-->
    <select id="ProductNum" parameterType="int" resultType="ProductDto">
        select *
        from product
        where p_num = #{p_num}
    </select>

    <!--상품 추가-->
    <insert id="InsertProduct" parameterType="JoinDto">
        insert into product (category, photo, brand, gender, p_name, price)
        values (#{category}, #{photo}, #{brand}, #{gender}, #{p_name}, #{price})
    </insert>

    <insert id="InsertInven" parameterType="JoinDto">
        insert into inven (p_num,p_size, amount)
        values (#{p_num},#{p_size},#{amount})
    </insert>

    <!--상품 삭제-->
    <delete id="DeleteProduct" parameterType="int">
        delete from product where p_num = #{p_num};
        delete from inven where p_num = #{p_num}
    </delete>

    <!--상품 업데이트-->
    <update id="UpdateProduct" parameterType="JoinDto">
        update product set category=#{category}, brand=#{brand},price=#{price},
                           gender=#{gender}, p_name=#{p_name}
        <if test="photo != null">
            ,photo=#{photo}
        </if>
        where p_num = #{p_num}
    </update>
<!--    인벤 업데이트-->
    <update id="UpdateInven" parameterType="JoinDto">
        update inven set p_size=#{p_size},amount=#{amount} where p_num = #{p_num}
    </update>

<!--    Join한 inven테이블에 p_num을 넣기위한 sql문-->
    <select id="getMaxPnum" resultType="int">
        select max(p_num) from product
    </select>

<!--    선택 정보 가져오기-->
    <select id="selectProduct" parameterType="int" resultType="JoinDto">
        SELECT product.p_num,
               product.category,
               product.photo,
               product.brand,
               product.p_name,
               product.price,
               product.gender,
               inven.i_num,
               inven.sellamount,
               inven.p_size,
               inven.amount
        from product
                 left join inven on product.p_num = inven.p_num where inven.i_num=#{i_num}
    </select>
    <!--=================================상품관리 시작=============================================-->
<!--    배송전 목록의 수-->
    <select id="TotalBeforeDelivery" resultType="int">
        select count(*)
        from trade where state='배송 전'
    </select>

<!--    배송관리 배송전 페이징 -->
    <select id="BeforeDeliveryPaging" parameterType="Map" resultType="TradeDto">
        select *
        from trade
        where state='배송 전' limit #{startnum}, #{perpage}
    </select>

<!--    배송 전 invoice 넣기 -->
    <update id="InsertInvoice" parameterType="TradeDto">
        update trade set invoice = #{invoice}, state = '배송 중' where t_num = #{t_num}
    </update>

<!--    배송 중 invoice 수정 -->
    <update id="UpdateInvoice" parameterType="TradeDto">
        update trade set invoice = #{invoice} where t_num = #{t_num}
    </update>

    <!--    배송중 목록의 수-->
    <select id="TotalDelivering" resultType="int">
        select count(*)
        from trade where state='배송 중'
    </select>

    <!--    배송관리 배송중 페이징 -->
    <select id="DeliveringPaging" parameterType="Map" resultType="TradeDto">
        select *
        from trade
        where state='배송 중' limit #{startnum}, #{perpage}
    </select>

    <!--    배송완료 목록의 수-->
    <select id="TotalDeliveryComplete" resultType="int">
        select count(*)
        from trade where state='배송 완료'
    </select>

    <!--    배송완료 배송전 페이징 -->
    <select id="DeliveryCompletePaging" parameterType="Map" resultType="TradeDto">
        select *
        from trade
        where state='배송 완료' limit #{startnum}, #{perpage}
    </select>
    <!--=================================배너시작=============================================-->
    <!--배너리스트-->
    <select id="getBannerList" resultType="AdminDto">
        select *
        from banner
        order by b_num asc
    </select>

    <!--배너업로드-->
    <insert id="InsertBanner" parameterType="AdminDto">
        insert into banner (b_photo)
        values (#{b_photo})
    </insert>

    <!--배너삭제-->
    <delete id="DeleteBanner" parameterType="int">
        delete
        from banner
        where b_num = #{b_num}
    </delete>

    <!--배너 업데이트-->
    <update id="UpdateBanner" parameterType="int">
        update banner
        set b_photo = #{b_photo}
        where b_num = #{b_num}
    </update>


</mapper>